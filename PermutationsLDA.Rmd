---
title: "R Notebook"
output: html_notebook
---

# Permuting GFP Permutations

## Set up
``` {r}

library(PredPsych)
library(MASS)

# function for imputing
impute_lda = function(x) {
  
  # remove spaces
  names(x) = gsub(" ", "_", names(x))
  names(x) = gsub("-", ".", names(x))
  
  # impute
  x = mice::complete(mice(x, m=5, seed=25))
  return(x)
}

cast_lda = function(x) {
  result = x %>%
  ddply(.(ID), transform, z = scale(weighted)) %>%
  dcast(ID ~ System, value.var="z", fun.aggregate = mean, .drop=T) 
  
  return(result)
}


```

# H2BGFP LDA

## GFP For all 4
```{r, fig.height=1.5, fig.width=2}

lda.gfp.4 = cast_lda(gfp) %>%
  merge(., animal_details %>% 
  mutate(GRAIN = paste(EXPT, VALENCE)) %>% 
  dplyr::select(ID, GRAIN), by="ID") 
  impute_lda()

# for  all 4
PermutationResult <- ClassPerm(Data = lda.gfp.4, classCol = 17, 
                               selectedCols = c(2:17), nSims = 100, 
                               classifierFun = LinearDA,
                               cvFraction = 0.80)

```

## GFP - old SHK/CTX
```{r}
lda.gfp.2old = cast_lda(gfp %>% filter(EXPT=='OLD')) %>%
  merge(., animal_details %>% 
  mutate(GRAIN = paste(VALENCE)) %>% 
  dplyr::select(ID, GRAIN), by="ID") %>%
  impute_lda()

# for  all 4
PermutationResult <- ClassPerm(Data = lda.gfp.2old, classCol = 17, 
                               selectedCols = c(2:17), nSims = 100, 
                               classifierFun = LinearDA,
                               cvFraction = 0.80)
```

## GFP - young SHK/CTX
```{r}
lda.gfp.2young = cast_lda(gfp %>% filter(EXPT=='YOUNG')) %>%
  merge(., animal_details %>% 
  mutate(GRAIN = paste(VALENCE)) %>% 
  dplyr::select(ID, GRAIN), by="ID") %>%
  impute_lda()

# for  all 4
PermutationResult <- ClassPerm(Data = lda.gfp.2young, classCol = 17, 
                               selectedCols = c(2:17), nSims = 100, 
                               classifierFun = LinearDA,
                               cvFraction = 0.80)
```
# Arc LDA


## Arc by all 4
```{r, fig.height=1.5, fig.width=2}

lda.arc.4 = cast_lda(arc) %>%
  merge(., animal_details %>% 
  mutate(GRAIN = paste(EXPT, VALENCE)) %>% 
  dplyr::select(ID, GRAIN), by="ID") %>%
  impute_lda()

# for 4
PermutationResult <- ClassPerm(Data = lda.arc.4, classCol = 17, 
                               selectedCols = c(2:17), nSims = 100, 
                               classifierFun = LinearDA,
                               # cvType = "holdout",
                               cvFraction = 0.80)

```

## Arc - young SHK/CTX
```{r}
lda.arc.2young = cast_lda(arc %>% filter(EXPT=='YOUNG')) %>%
  merge(., animal_details %>% 
  mutate(GRAIN = paste(VALENCE)) %>% 
  dplyr::select(ID, GRAIN), by="ID") %>%
  impute_lda()

# for  all 4
PermutationResult <- ClassPerm(Data = lda.arc.2young, classCol = 17, 
                               selectedCols = c(2:17), nSims = 100, 
                               classifierFun = LinearDA,
                               cvFraction = 0.80)
```

## Arc - old SHK/CTX
```{r}
lda.arc.2old = cast_lda(arc %>% filter(EXPT=='OLD')) %>%
  merge(., animal_details %>% 
  mutate(GRAIN = paste(VALENCE)) %>% 
  dplyr::select(ID, GRAIN), by="ID") %>%
  impute_lda()

# for  all 4
PermutationResult <- ClassPerm(Data = lda.arc.2old, classCol = 17, 
                               selectedCols = c(2:17), nSims = 100, 
                               classifierFun = LinearDA,
                               cvFraction = 0.80)
```


# NORM OL by all 4
```{r}

data.for.lda = nol %>%
  ddply(.(ID), transform, z = scale(weighted)) %>%
  dcast(ID ~ System, value.var="z", fun.aggregate = mean, .drop=T) 

data.for.lda = merge(data.for.lda, animal_details %>% 
                       mutate(GRAIN = paste(EXPT, VALENCE)) %>% 
                       dplyr::select(ID, GRAIN), by="ID")

# remove spaces? 
names(data.for.lda) = gsub(" ", "_", names(data.for.lda))
names(data.for.lda) = gsub("-", ".", names(data.for.lda))

# impute data
data.for.lda = mice::complete(mice(data.for.lda, m=5, seed=25))

# for 4
PermutationResult <- ClassPerm(Data = data.for.lda, classCol = 17, 
                               selectedCols = c(2:17), nSims = 100, 
                               classifierFun = LinearDA,
                               # cvType = "holdout",
                               cvFraction = 0.80)

```
