---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

# Permuting GFP Permutations
## Set up
```{r}
data.for.lda = gfp %>%
  ddply(.(System), transform, z = scale(weighted)) %>%
  dcast(ID ~ System, value.var="z", fun.aggregate = mean, .drop=T) 

data.for.lda = merge(data.for.lda, animal_details %>% 
                       # filter(EXPT=='OLD') %>%
                       mutate(GRAIN = paste(EXPT, VALENCE)) %>% 
                       dplyr::select(ID, GRAIN), by="ID")

# remove spaces? 
names(data.for.lda) = gsub(" ", "_", names(data.for.lda))
names(data.for.lda) = gsub("-", ".", names(data.for.lda))

# impute data
data.for.lda = mice::complete(mice(data.for.lda, m=5, seed=25))

data.fl = data.for.lda %>%
  mutate(factor = case_when(
    GRAIN == 'AGE 10 SHOCK' ~ "y-shk",
    GRAIN == 'AGE 11 SHOCK' ~ "o-shk",
    GRAIN %in% c('AGE 10 CONTEXT', 'AGE 11 CONTEXT') ~ "else"
  ))

# data.fl = data.for.lda %>%
#   mutate(factor = GRAIN)


LDAModel <- LinearDA(Data = data.fl, classCol = 17, 
                     selectedCols = c(2:15,17), cvType="holdout",
                     cvFraction = 0.75)

# for 3
PermutationResult <- ClassPerm(Data = data.fl, classCol = 17, 
                               selectedCols = c(2:15,17), nSims = 100, cvType = "holdout",
                               cvFraction = 0.80)


```

## For all 4
```{r}
data.for.lda = gfp %>%
  ddply(.(System), transform, z = scale(weighted)) %>%
  dcast(ID ~ System, value.var="z", fun.aggregate = mean, .drop=T) 

data.for.lda = merge(data.for.lda, animal_details %>% 
                       # filter(EXPT=='OLD') %>%
                       mutate(GRAIN = paste(EXPT, VALENCE)) %>% 
                       dplyr::select(ID, GRAIN), by="ID")

# remove spaces? 
names(data.for.lda) = gsub(" ", "_", names(data.for.lda))
names(data.for.lda) = gsub("-", ".", names(data.for.lda))

# impute data
data.for.lda = mice::complete(mice(data.for.lda, m=5, seed=25))
# 
# data.fl = data.for.lda %>%
#   mutate(factor = case_when(
#     GRAIN == 'AGE 10 SHOCK' ~ "y-shk",
#     GRAIN == 'AGE 11 SHOCK' ~ "o-shk",
#     GRAIN %in% c('AGE 10 CONTEXT', 'AGE 11 CONTEXT') ~ "else"
#   ))

data.fl = data.for.lda %>%
  mutate(factor = GRAIN)


LDAModel <- LinearDA(Data = data.fl, classCol = 17, 
                     selectedCols = c(2:15,17), cvType="holdout",
                     cvFraction = 0.75)

# for  all 4
PermutationResult <- ClassPerm(Data = data.fl, classCol = 17, 
                               selectedCols = c(2:15,17), nSims = 100, cvType = "holdout",
                               cvFraction = 0.80)

```

# shock vs context? no way
```{r}
data.for.lda = gfp %>%
  ddply(.(System), transform, z = scale(weighted)) %>%
  dcast(ID ~ System, value.var="z", fun.aggregate = mean, .drop=T) 

data.for.lda = merge(data.for.lda, animal_details %>% 
                       # filter(EXPT=='OLD') %>%
                       mutate(GRAIN = paste(EXPT)) %>% 
                       dplyr::select(ID, GRAIN), by="ID")

# remove spaces? 
names(data.for.lda) = gsub(" ", "_", names(data.for.lda))
names(data.for.lda) = gsub("-", ".", names(data.for.lda))

# impute data
data.for.lda = mice::complete(mice(data.for.lda, m=5, seed=25))

# data.fl = data.for.lda %>%
#   mutate(factor = case_when(
#     GRAIN == 'AGE 10 SHOCK' ~ "y-shk",
#     GRAIN == 'AGE 11 SHOCK' ~ "o-shk",
#     GRAIN %in% c('AGE 10 CONTEXT', 'AGE 11 CONTEXT') ~ "else"
#   ))

data.fl = data.for.lda %>%
  mutate(factor = GRAIN)


# for 2
PermutationResult <- ClassPerm(Data = data.fl, classCol = 17, 
                               selectedCols = c(2:17), nSims = 100, cvType = "holdout",
                               cvFraction = 0.80)

```




