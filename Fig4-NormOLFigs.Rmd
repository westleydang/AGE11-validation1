---
title: "R Notebook"
output: html_notebook
---

This is a new notebook to do the NormOL analysis for the manuscript.

Make sure to LoadLibs and get the data from the Post-Matlab Notebook!
- knew.molten3
- sys.weighted
- total.weighted


# Get the NormOL data
```{r, fig.width=2.1, fig.height=1.5}

sys.weighted %>%  aged() %>%
  filter(CHANNEL=='NormOL') %>%
  # filter(System %in% c('PFC')) %>%
  mutate(CONTEXT == factor(CONTEXT, levels=c("AB", "AA"))) %>%
  ggplot() + aes(CONTEXT, weighted, fill=CONTEXT) + 
  stat_summary(fun.y="mean", geom="bar", position=position_dodge(1)) +
  stat_summary(fun.data="mean_se", geom="errorbar", position=position_dodge(1), aes(width=0.3)) +
  facet_wrap(VALENCE~EXPT, ncol=4) +theme_minimal() + remove_grids() +
  labs(y="NormOL (cells/mm^2)",
       x=element_blank(), title="Total brain") +
  theme(axis.line=element_line(), legend.position = "none") +
  scale_y_continuous(expand = c(0, 0)) +
  coord_cartesian(ylim=c(0,0.02))


# sys.weighted %>%  aged() %>%
#   filter(CHANNEL=='NormOL' & VALENCE=='CONTEXT') %>%
#   # filter(System %in% c('PFC')) %>%
#   mutate(CONTEXT == factor(CONTEXT, levels=c("AB", "AA"))) %>%
#   ggplot() + aes(CONTEXT, weighted, fill=CONTEXT) + 
#   stat_summary(fun.y="mean", geom="bar", position=position_dodge(1)) +
#   stat_summary(fun.data="mean_se", geom="errorbar", position=position_dodge(1), aes(width=0.3)) +
#   facet_wrap(~EXPT, ncol=4) +theme_minimal() + remove_grids() +
#   labs(y="NormOL (cells/mm^2)",
#        x=element_blank(), title="Total brain, context") +
#   theme(axis.line=element_line()) +
#   scale_y_continuous(expand = c(0, 0))
```

# Stats, Total brain
```{r}
# AGED ANIMALS
aged.shock.nol.aa = total.weighted %>% aged() %>%
  filter(EXPT == 'AGED' & VALENCE == 'SHOCK') %>%
  filter(CHANNEL=='NormOL' & CONTEXT=='AA')

aged.shock.nol.ab = total.weighted %>% aged() %>%
  filter(EXPT == 'AGED' & VALENCE == 'SHOCK') %>%
  filter(CHANNEL=='NormOL' & CONTEXT=='AB')

t.test(aged.shock.nol.aa$weighted, aged.shock.nol.ab$weighted)

# YOUNG ANIMALS
young.shock.nol.aa = total.weighted %>% aged() %>%
  filter(EXPT == 'YOUNG' & VALENCE == 'SHOCK') %>%
  filter(CHANNEL=='NormOL' & CONTEXT=='AA')

young.shock.nol.ab = total.weighted %>% aged() %>%
  filter(EXPT == 'YOUNG' & VALENCE == 'SHOCK') %>%
  filter(CHANNEL=='NormOL' & CONTEXT=='AB')

t.test(young.shock.nol.aa$weighted, young.shock.nol.ab$weighted)

#====================================

shock.nol = total.weighted %>% aged() %>%
  filter(VALENCE == 'SHOCK') %>%
  filter(CHANNEL=='NormOL')

wilcox.test(formula = weighted ~ CONTEXT, data=shock.nol %>% filter(EXPT=='AGED'))
wilcox.test(formula = weighted ~ CONTEXT, data=shock.nol %>% filter(EXPT=='YOUNG'))


```



```{r, fig.width=1.5, fig.height=1.5}
# Print graph of the PFC only the AA vs AB for Shock
sys.weighted %>%  aged() %>%
  filter(CHANNEL=='NormOL' & VALENCE=='SHOCK') %>%
  filter(System %in% c('PFC')) %>%
  mutate(CONTEXT == factor(CONTEXT, levels=c("AB", "AA"))) %>%
  ggplot() + aes(CONTEXT, weighted, fill=CONTEXT) + 
  stat_summary(fun.y="mean", geom="bar", position=position_dodge(1)) +
  stat_summary(fun.data="mean_se", geom="errorbar", position=position_dodge(1), aes(width=0.3)) +
  facet_wrap(~EXPT, ncol=4) +theme_minimal() + remove_grids() +
  labs(y="NormOL (cells/mm^2)",
       x=element_blank(), title="PFC") +
  theme(legend.position="none", axis.line=element_line()) +
  scale_y_continuous(expand = c(0, 0))
  

sys.weighted %>%  aged() %>%
  filter(CHANNEL=='NormOL' & VALENCE=='SHOCK') %>%
  filter(System %in% c('SUBIC-HPC')) %>%
  mutate(CONTEXT == factor(CONTEXT, levels=c("AB", "AA"))) %>%
  ggplot() + aes(CONTEXT, weighted, fill=CONTEXT) + 
  stat_summary(fun.y="mean", geom="bar", position=position_dodge(1)) +
  stat_summary(fun.data="mean_se", geom="errorbar", position=position_dodge(1), aes(width=0.3)) +
  facet_wrap(~EXPT, ncol=4) +theme_minimal() + remove_grids() +
  labs(y="NormOL (cells/mm^2)",
       x=element_blank(), title="SUBIC-HPC") +
  theme(legend.position="none", axis.line=element_line()) +
  scale_y_continuous(expand = c(0, 0))
  
sys.weighted %>% aged() %>%
  filter(CHANNEL=='NormOL' & VALENCE=='SHOCK') %>%
  filter(System %in% c('CORTICO-AMY')) %>%
  mutate(CONTEXT == factor(CONTEXT, levels=c("AB", "AA"))) %>%
  ggplot() + aes(CONTEXT, weighted, fill=CONTEXT) + 
  stat_summary(fun.y="mean", geom="bar", position=position_dodge(1)) +
  stat_summary(fun.data="mean_se", geom="errorbar", position=position_dodge(1), aes(width=0.3)) +
  facet_wrap(~EXPT, ncol=4) +theme_minimal() + remove_grids() +
  labs(y="NormOL (cells/mm^2)",
       x=element_blank(), title="CORTICO-AMY") +
  theme(legend.position="none", axis.line=element_line()) +
  scale_y_continuous(expand = c(0, 0))
```

# Stats for PFC
```{r}

pfc.shock.nol = sys.weighted %>% aged() %>%
  filter(CHANNEL=='NormOL' & VALENCE=='SHOCK') %>%
  filter(System=='PFC') 
wilcox.test(formula = weighted ~ CONTEXT, data=pfc.shock.nol %>% filter(EXPT=='YOUNG'))
wilcox.test(formula = weighted ~ CONTEXT, data=pfc.shock.nol %>% filter(EXPT=='AGED'))

```


# Stats for HPC
```{r}
hpc.shock.nol = sys.weighted %>% aged() %>%
  filter(CHANNEL=='NormOL' & VALENCE=='SHOCK') %>%
  filter(System=='SUBIC-HPC') 
wilcox.test(formula = weighted ~ CONTEXT, data=hpc.shock.nol %>% filter(EXPT=='YOUNG'))
wilcox.test(formula = weighted ~ CONTEXT, data=hpc.shock.nol %>% filter(EXPT=='AGED'))

```


# EXPT:VALENCE effects
No context dependent effects. OK but what I did find here is that there are age-valence effects that mirror the total brain. These are found from the ANOVA. 

```{r}

sys.nol = sys.weighted %>% aged() %>% filter(CHANNEL == 'NormOL')

wilcox.test(formula = weighted ~ VALENCE, data = sys.nol %>% filter(System == 'SUBIC-HPC' & EXPT == 'YOUNG'))
wilcox.test(formula = weighted ~ VALENCE, data = sys.nol %>% filter(System == 'SUBIC-HPC' & EXPT == 'AGED'))

wilcox.test(formula = weighted ~ VALENCE, data = sys.nol %>% filter(System == 'TEMP ASSOC CTX' & EXPT == 'YOUNG'))
wilcox.test(formula = weighted ~ VALENCE, data = sys.nol %>% filter(System == 'TEMP ASSOC CTX' & EXPT == 'AGED'))

```

```{r}
sys.nol %>% filter(System == 'TEMP ASSOC CTX') %>%
  ggplot() + aes(VALENCE, weighted, fill=VALENCE) +
  stat_summary(fun.y="mean", geom="bar") +
  stat_summary(fun.data = "mean_se", geom="errorbar") + 
  facet_wrap(~EXPT) + ggtitle("TEMP ASSOC CTX")

sys.nol %>% filter(System == 'SUBIC-HPC') %>%
  ggplot() + aes(VALENCE, weighted, fill=VALENCE) +
  stat_summary(fun.y="mean", geom="bar") +
  stat_summary(fun.data = "mean_se", geom="errorbar") + 
  facet_wrap(~EXPT) + ggtitle("SUBIC-HPC")
  
```

# Separating out AA and AB groups

The goal here is to separate out just AA and AB groups into different facets. The idea is that perhaps the AB groups confound the normalized overlap in the shock/context. 

So we want to ask: is this effect the same whether we collapse the contexts together, or are they different between AA/AB

The answer here is that they kind of look the same: 


```{r}

# use total.weighted

total.weighted %>% aged() %>% filter(CHANNEL == 'NormOL') %>%
  ggplot() + aes(VALENCE, weighted, fill=VALENCE) +
  stat_summary(fun.y = "mean", geom = "bar") +
  stat_summary(fun.data = "mean_se", geom="errorbar", aes(width=0.2)) +
  facet_wrap(CONTEXT~EXPT, ncol=4) + theme_minimal()

```

## stats: is AB YOUNG shock > context significant?
Yes:

```{r}
ab.young.nol = total.weighted %>% aged() %>% 
  filter(CHANNEL == "NormOL" & EXPT == 'YOUNG' & CONTEXT == 'AB')

# DO A NON-PARAMETRIC TEST
wilcox.test(formula = weighted ~ VALENCE, data = ab.young.nol)

# TRY A T-TEST
t.test(ab.young.nol %>% filter(VALENCE=='SHOCK') %>% pull(weighted),
       ab.young.nol %>% filter(VALENCE=='CONTEXT') %>% pull(weighted))
```


## STATS: what about AA YOUNG, shock > context?

```{r}
aa.young.nol = total.weighted %>% aged() %>% 
  filter(CHANNEL == "NormOL" & EXPT == 'YOUNG' & CONTEXT == 'AA')

# DO A NON-PARAMETRIC TEST
wilcox.test(formula = weighted ~ VALENCE, data = aa.young.nol)

# TRY A T-TEST
t.test(aa.young.nol %>% filter(VALENCE=='SHOCK') %>% pull(weighted),
       aa.young.nol %>% filter(VALENCE=='CONTEXT') %>% pull(weighted))
```
Nope, not significant. 


## But what if we faceted out the age cohorts?

```{r}

# use total.weighted

total.weighted %>% aged() %>% filter(CHANNEL == 'NormOL') %>%
  ggplot() + aes(CONTEXT, weighted, fill=CONTEXT) +
  stat_summary(fun.y = "mean", geom = "bar") +
  stat_summary(fun.data = "mean_se", geom="errorbar", aes(width=0.2)) +
  facet_wrap(EXPT~VALENCE, ncol=4) + theme_minimal()

```

