---
title: "R Notebook"
output: html_notebook
---

# Inter-regional correlations - TOTAL
Conditions in this set of graphs:
- 1. 'Total' cells only
- 2. Density measures
- 3. Correlations use "complete.obs"
- 4. Ordering by "hclust"
- 5. Removed bad freezers from young group

```{r}
# detach("package:plyr", unload = T)
source("LoadLibs.R")
library(psych)
library(RColorBrewer)
library(gplots)
knew.molten3 = knew.molten2 %>%
  filter(UNITS == "density") %>%
  filter(BRIGHTNESS == 'total')

cluster.method = "hclust"
use.method = "complete.obs"
corr.type = "pearson"

```

# Define functions for getting correlation tests, making heatmaps
```{r}
# DEFINE FUNCTION FOR GETTING CORRELATION TEST
get_corrtest = function(df) {
  data = df %>%
    mutate(grain2 = paste(CHANNEL, SubROI_SubroiAGGR)) %>%
    ddply(.(CHANNEL, SubROI_SubroiAGGR), transform, z = scale(value)) %>%
    dcast(ID ~ grain2, value.var="z", fun.aggregate = mean) 
  
  cor(data[,2:length(data)], data[,2:length(data)], use=use.method, method=corr.type)
  # corr.test(cor1)
}

# DEFINE FUNCTION FOR MAKING HEATMAP
make_heatmap = function(test.results, title) {
  # inputs the results from 'get_corrtest'
  # matrix = test.results$r
  heatmap.2(test.results, symm=T, col=rev(brewer.pal(11,"RdBu")), main=title, trace="none", revC=T)
}


# DEFINE FUNCTION FOR MAKING HEATMAP FOR NUMBER ANIMALS
make_heatmap2 = function(test.results, title) {
  # inputs the results from 'get_corrtest'
  # matrix = test.results$r
  heatmap(test.results, symm=T, col=heat.colors, main=title)
}

```

# ARCIHC
```{r}
# SUBSET FOR ARC ONLY
arc = knew.molten3 %>% filter(CHANNEL=='ArcIHC')
```


## Arc:: VALENCE (2)
```{r, fig.width=8, fig.height=8}

# MAKE THE GRAPHS
for (val in levels(unique(knew.molten3$VALENCE))) {
  title = paste("all ArcIHC, ", val, " withlow freezers removed")
  a = arc %>%
    filter(VALENCE == val) %>%
    filter(!(EXPT =='YOUNG' & GROUP=='SAA' & FREEZE < 30)) %>% # removes young bad freezers
    get_corrtest() %>%
    make_heatmap(., title)
}

```
## Arc:: AGE x VALENCE (4)
```{r, fig.width=8, fig.height=8}

# MAKE THE GRAPHS
for (val in levels(unique(knew.molten3$VALENCE))) {
  for (age in levels(unique(as.factor(knew.molten3$EXPT)))) {
    
    title = paste(age, val, "")
  
    a = arc %>%
      filter(VALENCE == val) %>%
      filter(EXPT == age) %>%
      # filter(!(EXPT =='YOUNG' & GROUP=='SAA' & FREEZE < 30)) %>% # removes young bad freezers
      get_corrtest() %>%
      make_heatmap(., title)
  }
}

```

## Arc:: AGE x VALENCE x CONTEXT (8)

```{r, fig.width=8, fig.height=8}
for (ctx in levels(unique(knew.molten3$CONTEXT))) {
  for (val in levels(unique(knew.molten3$VALENCE))) {
    for (age in levels(unique(as.factor(knew.molten3$EXPT)))) {
      
      title = paste(age, val, ctx, "")
    
      a = arc %>%
        filter(VALENCE == val) %>%
        filter(CONTEXT == ctx) %>%
        # filter(!(EXPT =='YOUNG' & GROUP=='SAA' & FREEZE < 30)) %>% # removes young bad freezers
        get_corrtest() %>%
        make_heatmap(., title)
    }
  }
}

```

## OL (NormOL)
```{r}

# SUBSET FOR OL ONLY
ol = knew.molten3 %>% filter(CHANNEL=='NormOL')
```



## OL:: VALENCE (2)
```{r, fig.width=8, fig.height=8}

# MAKE THE GRAPHS
for (val in levels(unique(knew.molten3$VALENCE))) {
  title = paste("all OL, ", val, " withlow freezers removed")
  a = ol %>%
    filter(VALENCE == val) %>%
    filter(!(EXPT =='YOUNG' & GROUP=='SAA' & FREEZE < 30)) %>% # removes young bad freezers
    get_corrtest() %>%
    make_heatmap(., title)
}

```
## OL:: AGE x VALENCE (4)
```{r, fig.width=8, fig.height=8}

# MAKE THE GRAPHS
for (val in levels(unique(knew.molten3$VALENCE))) {
  for (age in levels(unique(as.factor(knew.molten3$EXPT)))) {
    
    title = paste(age, val, "")
  
    a = ol %>%
      filter(VALENCE == val) %>%
      filter(EXPT == age) %>%
      # filter(!(EXPT =='YOUNG' & GROUP=='SAA' & FREEZE < 30)) %>% # removes young bad freezers
      get_corrtest() %>%
      make_heatmap(., title)
  }
}

```

## OL:: AGE x VALENCE x CONTEXT (8)

```{r, fig.width=8, fig.height=8}
for (ctx in levels(unique(knew.molten3$CONTEXT))) {
  for (val in levels(unique(knew.molten3$VALENCE))) {
    for (age in levels(unique(as.factor(knew.molten3$EXPT)))) {
      
      title = paste(age, val, ctx, "")
    
      a = ol %>%
        filter(VALENCE == val) %>%
        filter(CONTEXT == ctx) %>%
        # filter(!(EXPT =='YOUNG' & GROUP=='SAA' & FREEZE < 30)) %>% # removes young bad freezers
        get_corrtest() %>%
        make_heatmap(., title)
    }
  }
}

```


## H2BGFP 
```{r}

# SUBSET FOR OL ONLY
gfp = knew.molten3 %>% filter(CHANNEL=='H2BGFP')
```



## H2BGFP:: VALENCE (2)
```{r, fig.width=8, fig.height=8}

# MAKE THE GRAPHS
for (val in levels(unique(knew.molten3$VALENCE))) {
  title = paste("all OL, ", val, " withlow freezers removed")
  a = gfp %>%
    filter(VALENCE == val) %>%
    filter(!(EXPT =='YOUNG' & GROUP=='SAA' & FREEZE < 30)) %>% # removes young bad freezers
    get_corrtest() %>%
    make_heatmap(., title)
}

```
## H2BGFP:: AGE x VALENCE (4)
```{r, fig.width=8, fig.height=8}

# MAKE THE GRAPHS
for (val in levels(unique(knew.molten3$VALENCE))) {
  for (age in levels(unique(as.factor(knew.molten3$EXPT)))) {
    
    title = paste(age, val, "")
  
    a = gfp %>%
      filter(VALENCE == val) %>%
      filter(EXPT == age) %>%
      # filter(!(EXPT =='YOUNG' & GROUP=='SAA' & FREEZE < 30)) %>% # removes young bad freezers
      get_corrtest() %>%
      make_heatmap(., title)
  }
}

```

## H2BGFP:: AGE x VALENCE x CONTEXT (8)

```{r, fig.width=8, fig.height=8}
for (ctx in levels(unique(knew.molten3$CONTEXT))) {
  for (val in levels(unique(knew.molten3$VALENCE))) {
    for (age in levels(unique(as.factor(knew.molten3$EXPT)))) {
      
      title = paste(age, val, ctx, "")
    
      a = gfp %>%
        filter(VALENCE == val) %>%
        filter(CONTEXT == ctx) %>%
        # filter(!(EXPT =='YOUNG' & GROUP=='SAA' & FREEZE < 30)) %>% # removes young bad freezers
        get_corrtest() %>%
        make_heatmap(., title)
    }
  }
}

```


